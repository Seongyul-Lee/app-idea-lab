# 데일리셀프 (DailySelf) — PRD (Product Requirements Document)

> **문서 버전**: v1.0
> **작성일**: 2026-01-30
> **상태**: 채택 (2026-01-30)
> **아이디어 문서**: `ideas/001-데일리셀프.md`

---

## 1. Executive Summary

**데일리셀프**는 매일 아침 30초 컨디션 체크인(에너지, 수면, 기분)을 기반으로 오늘에 최적화된 루틴을 자동 제안하는 **적응형 일일 플래너** 앱이다.

기존 루틴 앱(루티너리, 챌린저스, 마이루틴 등)은 "매일 같은 계획"을 강요하지만, 한국 직장인의 현실은 야근·회식·수면 부족으로 에너지가 매일 다르다. 데일리셀프는 **"작심삼일은 의지력 문제가 아니라, 앱이 컨디션을 몰랐을 뿐"**이라는 관점에서, 컨디션에 따라 루틴 난이도를 자동 조절하여 **실패하지 않는 구조**를 제공한다.

### 핵심 지표
| 항목 | 목표 |
|------|------|
| MVP 출시 | 3개월 이내 |
| 타겟 시장 | 한국 MZ세대 직장인/대학생 (SAM 710만 명) |
| 1년차 목표 사용자 | 5~10만 명 |
| 1년차 목표 매출 | 0.5~1.5억 원 |
| 수익 모델 | 프리미엄 구독 (월 3,900원 / 연 29,900원) |

---

## 2. Problem Statement

### 2-1. 핵심 문제

**"한국 직장인은 매일 다른 컨디션으로 살지만, 루틴 앱은 매일 같은 계획을 강요한다."**

### 2-2. 문제의 근거 (데이터 기반)

| 데이터 포인트 | 수치 | 출처 |
|-------------|------|------|
| 야근 경험 직장인 비율 | 63% | 잡코리아/인크루트 |
| 자기계발 실패 사유 1위 | "정시퇴근 어려움" 62.4% | 잡코리아 설문 |
| 자기계발 실패 사유 2위 | "피곤해서" 56.6% | 잡코리아 설문 |
| 번아웃 경험률 | 69~93% | 한국리서치/잡코리아 |
| 습관 앱 6개월 내 이탈률 | 48% | 업계 통계 |
| 루틴 보유 성인 비율 | 80% | 오픈서베이 |

### 2-3. 기존 솔루션의 한계

```
현재 시장의 접근 방식:
├── 고정 루틴 도구 (루티너리, 마이루틴)
│   └── 문제: 컨디션 무시 → 못 지키면 자책 → 이탈
├── 동기부여 도구 (챌린저스, 투두메이트)
│   └── 문제: 외적 동기만 제공 → 동기 소실 시 이탈
└── 감정 기록 도구 (하루콩, 루빗)
    └── 문제: 기록만 할 뿐, 행동과 연결하지 않음

→ 컨디션과 행동을 연결하는 앱은 시장에 부재
```

### 2-4. 사용자 시나리오 (Before/After)

**Before (기존 앱 사용)**
> 김대리(29세)는 오늘 야근 후 피곤하지만, 루티너리가 "21:00 운동 30분"을 알림. 체력이 없어 스킵 → 연속 달성 기록 끊김 → 자책 → 3일 후 앱 삭제

**After (데일리셀프 사용)**
> 김대리는 아침에 에너지 2/5, 수면 5시간, 기분 "피곤"을 30초 만에 체크인. 앱이 "오늘은 가볍게: 5분 스트레칭 + 따뜻한 차 한잔 + 10분 독서"를 제안. 가벼운 루틴이라 수행 → 달성감 → 다음 날도 체크인 지속

---

## 3. User Stories

### 3-1. 핵심 사용자 페르소나

**페르소나 A: "야근 김대리" (핵심 타겟)**
- 29세, 서울 IT기업 대리, 1인가구
- 주 2~3일 야근, 퇴근 시간 18:30~21:00 변동
- 루티너리 사용 3회 시도 후 포기
- 월 자기관리 지출 3~5만 원

**페르소나 B: "갓생 박사원생" (확장 타겟)**
- 25세, 서울 대학원생
- 수업/연구/아르바이트로 스케줄 유동적
- 투두메이트 사용 중이나 소셜 의존도에 불만
- 체계적 자기관리 시스템을 원함

### 3-2. User Story Map

#### Epic 1: 아침 컨디션 체크인
| ID | User Story | 우선순위 |
|----|-----------|---------|
| US-01 | 사용자로서, 아침에 30초 내에 오늘의 에너지(1-5), 수면 시간, 기분을 입력할 수 있다 | P0 |
| US-02 | 사용자로서, 체크인을 매일 아침 알림으로 받을 수 있다 | P0 |
| US-03 | 사용자로서, 체크인 시 어제의 수면 시간이 자동 추천되어 빠르게 입력할 수 있다 | P1 |

#### Epic 2: 적응형 루틴 제안
| ID | User Story | 우선순위 |
|----|-----------|---------|
| US-04 | 사용자로서, 체크인 결과에 따라 오늘에 맞는 루틴 목록을 자동으로 받을 수 있다 | P0 |
| US-05 | 사용자로서, 나만의 루틴 풀(카테고리별 루틴 목록)을 등록하고 관리할 수 있다 | P0 |
| US-06 | 사용자로서, 제안된 루틴을 수동으로 추가/삭제/교체할 수 있다 | P0 |
| US-07 | 사용자로서, 루틴별 예상 소요 시간을 볼 수 있다 | P1 |
| US-08 | 사용자로서, 에너지가 낮은 날에는 짧고 쉬운 루틴이 제안되는 것을 확인할 수 있다 | P0 |

#### Epic 3: 실행 및 기록
| ID | User Story | 우선순위 |
|----|-----------|---------|
| US-09 | 사용자로서, 각 루틴의 완료를 체크할 수 있다 | P0 |
| US-10 | 사용자로서, 저녁에 오늘의 달성률과 한줄 회고를 작성할 수 있다 | P0 |
| US-11 | 사용자로서, 루틴 타이머를 사용할 수 있다 | P2 |

#### Epic 4: 인사이트 및 통계
| ID | User Story | 우선순위 |
|----|-----------|---------|
| US-12 | 사용자로서, 주간 컨디션-달성률 상관관계 리포트를 볼 수 있다 | P0 |
| US-13 | 사용자로서, "에너지 3 이상인 날 달성률 85%" 같은 개인화된 인사이트를 받을 수 있다 | P1 |
| US-14 | 사용자로서, 월간 컨디션 트렌드를 캘린더 뷰에서 확인할 수 있다 | P1 |
| US-15 | 사용자로서, 가장 잘 지키는 루틴과 자주 건너뛰는 루틴을 파악할 수 있다 | P1 |

#### Epic 5: 온보딩
| ID | User Story | 우선순위 |
|----|-----------|---------|
| US-16 | 사용자로서, 최초 진입 시 3단계 온보딩으로 기본 루틴 풀을 빠르게 설정할 수 있다 | P0 |
| US-17 | 사용자로서, 카테고리별 추천 루틴 템플릿 중 선택하여 시작할 수 있다 | P0 |

---

## 4. Functional Requirements

### 4-1. MVP 기능 명세 (P0)

#### FR-01: 회원가입 및 인증
| 항목 | 명세 |
|------|------|
| 인증 방식 | 소셜 로그인 (카카오, 애플) + 이메일 로그인 |
| 온보딩 | 3단계: 관심 카테고리 선택 → 루틴 템플릿 선택 → 알림 시간 설정 |
| 데이터 | 닉네임, 프로필 이미지(선택), 알림 설정 |

#### FR-02: 아침 컨디션 체크인
| 항목 | 명세 |
|------|------|
| 입력 항목 | 에너지 레벨(1-5 슬라이더), 수면 시간(시간 피커), 오늘 기분(좋음/보통/나쁨 탭) |
| 소요 시간 | 30초 이내 |
| 알림 | 설정한 시간에 푸시 알림 (기본 07:00) |
| 미입력 시 | 전날 평균 컨디션 자동 적용 (사용자에게 고지) |

#### FR-03: 루틴 풀 관리
| 항목 | 명세 |
|------|------|
| 루틴 등록 | 이름, 카테고리, 예상 소요 시간, 난이도(상/중/하) |
| 카테고리 | 운동, 학습, 자기관리, 건강, 마음챙김 (기본 5개) |
| 무료 제한 | 최대 5개 루틴 등록 |
| 유료 | 무제한 루틴 + 커스텀 카테고리 |
| 템플릿 | 카테고리별 추천 루틴 20개 사전 제공 |

#### FR-04: 적응형 루틴 제안 엔진
| 항목 | 명세 |
|------|------|
| 입력 | 오늘 체크인 데이터 + 사용자 루틴 풀 |
| 로직 | 규칙 기반 (Rule-based) 매칭. 상세 규칙은 섹션 10 참조 |
| 에너지 1 | 난이도 '하' 루틴만 선택, 총 소요 20분 이내, 마음챙김 1개 필수 |
| 에너지 2 | 난이도 '하' 루틴만 선택, 총 소요 30분 이내 |
| 에너지 3 | 난이도 '하'+'중' 혼합, 총 소요 60분 이내 |
| 에너지 4 | 모든 난이도 가능, 총 소요 90분 이내 |
| 에너지 5 | 모든 난이도 가능, 총 소요 120분 이내 |
| 기분 '나쁨' | 마음챙김 카테고리 1개 필수 포함 |
| 수면 5시간 미만 | 운동 카테고리 난이도 자동 1단계 하향 |
| 수면 4시간 미만 | 에너지 레벨 최대 2로 캡 (강제 경량화) |
| 출력 | 오늘의 추천 루틴 리스트 (최대 5개) |
| 수동 조정 | 사용자가 추천 결과를 교체/추가/삭제 가능 |

#### FR-05: 루틴 실행 및 기록
| 항목 | 명세 |
|------|------|
| 체크 | 각 루틴 완료 시 탭으로 체크 |
| 달성률 | 완료 루틴 수 / 오늘 제안 루틴 수 × 100% |
| 저녁 회고 | 한줄 텍스트 입력 (선택) |
| 회고 알림 | 설정한 시간에 푸시 알림 (기본 22:00) |

#### FR-06: 주간 리포트
| 항목 | 명세 |
|------|------|
| 표시 데이터 | 7일간 에너지/수면/기분 추이 + 달성률 추이 |
| 인사이트 | 에너지-달성률 상관관계 문장 1개 (예: "에너지 3 이상인 날 달성률 85%") |
| 생성 주기 | 매주 일요일 자동 생성 |
| 접근 | 리포트 탭에서 과거 주간 리포트 열람 가능 |

### 4-2. Post-MVP 기능 (P1~P2)

| 우선순위 | 기능 | 설명 |
|---------|------|------|
| P1 | AI 개인화 인사이트 | 누적 데이터 기반 고급 패턴 분석 (유료 전용) |
| P1 | 월간 트렌드 분석 | 캘린더 뷰 + 월간 통계 (유료 전용) |
| P1 | 루틴 추천 고도화 | 과거 달성 패턴 학습으로 추천 정확도 향상 |
| P2 | 루틴 타이머 | 포모도로/일반 타이머 |
| P2 | 셀프케어 콘텐츠 | 카테고리별 가이드 콘텐츠 (유료 전용) |
| P2 | SNS 공유 | "오늘의 컨디션 체크" 결과 이미지 공유 |
| P2 | 위젯 | iOS/Android 홈 화면 위젯 |

---

## 5. Non-Functional Requirements

### 5-1. 성능
| 항목 | 기준 |
|------|------|
| 체크인 → 루틴 제안 응답 | 1초 이내 |
| 앱 초기 로딩 | 3초 이내 (콜드 스타트) |
| 오프라인 지원 | 체크인 및 루틴 체크는 오프라인 가능, 동기화는 온라인 시 수행 |
| 동시 접속 | 초기 1만 DAU 기준 설계 |

### 5-2. 보안
| 항목 | 기준 |
|------|------|
| 인증 | Supabase Auth (JWT 토큰 기반) |
| 데이터 격리 | Supabase RLS (Row Level Security) 적용 |
| 통신 | HTTPS/TLS 1.3 필수 |
| 개인정보 | 최소 수집 원칙, 한국 개인정보보호법 준수 |
| 데이터 삭제 | 회원 탈퇴 시 30일 내 완전 삭제 |

### 5-3. 접근성
| 항목 | 기준 |
|------|------|
| 플랫폼 | iOS 15+ / Android 10+ |
| 언어 | 한국어 (MVP), 영어 (Post-MVP) |
| 다크모드 | MVP에서 지원 |
| 폰트 크기 | 시스템 설정 연동 |

---

## 6. 시스템 아키텍처

### 6-1. 기술 스택

| 레이어 | 기술 | 선정 사유 |
|--------|------|----------|
| **프론트엔드** | React Native + TypeScript | 크로스플랫폼 단일 코드베이스, 1인 개발 최적 |
| **네비게이션** | React Navigation v6 | RN 표준 네비게이션 |
| **상태관리** | Zustand | 경량, 보일러플레이트 최소 |
| **UI 컴포넌트** | React Native Paper 또는 NativeBase | Material Design 기반, 다크모드 내장 |
| **백엔드** | Supabase (BaaS) | Auth, DB, Realtime, Storage 올인원 |
| **데이터베이스** | PostgreSQL (Supabase 내장) | 관계형 데이터, SQL 함수로 통계 계산 |
| **푸시 알림** | Expo Push Notifications | Expo 생태계 통합, 무료 |
| **인앱결제** | RevenueCat | iOS/Android 구독 통합 관리, 1인 개발 최적 |
| **분석** | PostHog (셀프호스트 또는 클라우드) | 오픈소스, 무료 티어 충분 |
| **CI/CD** | EAS Build + EAS Submit | Expo 공식 빌드/배포 도구 |

### 6-2. 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────┐
│                    React Native App                  │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐ │
│  │ 체크인    │ │ 루틴관리  │ │ 리포트    │ │ 설정   │ │
│  │ Screen   │ │ Screen   │ │ Screen   │ │ Screen │ │
│  └────┬─────┘ └────┬─────┘ └────┬─────┘ └───┬────┘ │
│       │            │            │            │      │
│  ┌────┴────────────┴────────────┴────────────┴────┐ │
│  │              Zustand State Store               │ │
│  └────────────────────┬───────────────────────────┘ │
│                       │                              │
│  ┌────────────────────┴───────────────────────────┐ │
│  │           Supabase Client SDK                  │ │
│  │  ┌──────┐ ┌──────────┐ ┌────────┐ ┌────────┐  │ │
│  │  │ Auth │ │ Database │ │ RPC    │ │ Push   │  │ │
│  │  └──────┘ └──────────┘ └────────┘ └────────┘  │ │
│  └────────────────────┬───────────────────────────┘ │
│                       │                              │
│  ┌────────────────────┴───────────────────────────┐ │
│  │        Adaptive Routine Engine (로컬)           │ │
│  │  입력: 체크인 데이터 + 루틴 풀                    │ │
│  │  출력: 오늘의 추천 루틴 리스트                     │ │
│  │  로직: 규칙 기반 (Rule-based)                    │ │
│  └────────────────────────────────────────────────┘ │
└────────────────────────┬────────────────────────────┘
                         │ HTTPS
┌────────────────────────┴────────────────────────────┐
│                  Supabase Backend                    │
│  ┌──────────┐ ┌──────────────┐ ┌─────────────────┐ │
│  │  Auth    │ │  PostgreSQL  │ │  Edge Functions │ │
│  │ (Kakao,  │ │  + RLS       │ │  (주간 리포트    │ │
│  │  Apple)  │ │              │ │   생성 등)      │ │
│  └──────────┘ └──────────────┘ └─────────────────┘ │
│  ┌──────────────────────────────────────────────┐   │
│  │  PostgreSQL Functions (통계 계산, 집계)        │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────┐
│               External Services                      │
│  ┌─────────────┐  ┌────────────┐  ┌──────────────┐ │
│  │ RevenueCat  │  │ Expo Push  │  │ PostHog      │ │
│  │ (결제 관리)  │  │ (알림)     │  │ (분석)       │ │
│  └─────────────┘  └────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────┘
```

### 6-3. 핵심 설계 원칙

1. **로컬 퍼스트**: 적응형 루틴 엔진은 클라이언트 로컬에서 실행. 서버 의존 없이 즉시 응답.
2. **오프라인 대응**: 체크인/루틴 체크는 로컬 저장 → 온라인 시 Supabase 동기화.
3. **서버리스**: Supabase Edge Functions로 주간 리포트 생성 등 서버 로직 처리. 별도 서버 운영 불필요.
4. **최소 외부 의존**: 핵심 로직에 외부 AI API 미사용. RevenueCat, Expo Push 정도만 의존.

---

## 7. 데이터베이스 설계

### 7-1. ERD 개요

```
users ──┬── check_ins ──── daily_plans ──── plan_items
        │
        ├── routines
        │
        ├── routine_categories
        │
        ├── reflections
        │
        └── weekly_reports
```

### 7-2. 테이블 명세

#### `users` (사용자)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK, DEFAULT gen_random_uuid() | Supabase Auth UID 연동 |
| email | text | UNIQUE, NOT NULL | 이메일 |
| nickname | text | NOT NULL | 닉네임 |
| avatar_url | text | NULLABLE | 프로필 이미지 URL |
| morning_alarm | time | DEFAULT '07:00' | 아침 체크인 알림 시간 |
| evening_alarm | time | DEFAULT '22:00' | 저녁 회고 알림 시간 |
| is_premium | boolean | DEFAULT false | 프리미엄 구독 여부 |
| premium_expires_at | timestamptz | NULLABLE | 구독 만료일 |
| onboarding_completed | boolean | DEFAULT false | 온보딩 완료 여부 |
| created_at | timestamptz | DEFAULT now() | 가입일 |
| updated_at | timestamptz | DEFAULT now() | 수정일 |

#### `routine_categories` (루틴 카테고리)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 카테고리 ID |
| user_id | uuid | FK → users.id | 사용자 ID (null이면 시스템 기본 카테고리) |
| name | text | NOT NULL | 카테고리명 |
| icon | text | NOT NULL | 아이콘 이모지 또는 아이콘명 |
| is_system | boolean | DEFAULT false | 시스템 기본 카테고리 여부 |
| sort_order | int | DEFAULT 0 | 정렬 순서 |
| created_at | timestamptz | DEFAULT now() | |

#### `routines` (루틴 풀)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 루틴 ID |
| user_id | uuid | FK → users.id, NOT NULL | 소유 사용자 |
| category_id | uuid | FK → routine_categories.id | 카테고리 |
| name | text | NOT NULL | 루틴명 (예: "30분 러닝") |
| duration_min | int | NOT NULL, CHECK > 0 | 예상 소요 시간(분) |
| difficulty | text | NOT NULL, CHECK IN ('low','mid','high') | 난이도 |
| is_active | boolean | DEFAULT true | 활성 여부 |
| is_template | boolean | DEFAULT false | 시스템 템플릿 여부 |
| created_at | timestamptz | DEFAULT now() | |
| updated_at | timestamptz | DEFAULT now() | |

#### `check_ins` (아침 컨디션 체크인)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 체크인 ID |
| user_id | uuid | FK → users.id, NOT NULL | 사용자 |
| date | date | NOT NULL | 체크인 날짜 |
| energy | int | NOT NULL, CHECK 1-5 | 에너지 레벨 |
| sleep_hours | numeric(3,1) | NOT NULL, CHECK >= 0 | 수면 시간 |
| mood | text | NOT NULL, CHECK IN ('good','normal','bad') | 기분 |
| created_at | timestamptz | DEFAULT now() | |
| UNIQUE | (user_id, date) | | 하루 1회 제한 |

#### `daily_plans` (일일 적응형 플랜)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 플랜 ID |
| user_id | uuid | FK → users.id, NOT NULL | 사용자 |
| check_in_id | uuid | FK → check_ins.id, NOT NULL | 연결된 체크인 |
| date | date | NOT NULL | 플랜 날짜 |
| total_duration_min | int | NOT NULL | 총 예상 소요 시간 |
| completion_rate | numeric(5,2) | DEFAULT 0 | 달성률 (%) |
| created_at | timestamptz | DEFAULT now() | |
| UNIQUE | (user_id, date) | | 하루 1개 플랜 |

#### `plan_items` (플랜 내 개별 루틴 항목)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 항목 ID |
| plan_id | uuid | FK → daily_plans.id, NOT NULL | 소속 플랜 |
| routine_id | uuid | FK → routines.id, NOT NULL | 루틴 참조 |
| sort_order | int | DEFAULT 0 | 순서 |
| is_completed | boolean | DEFAULT false | 완료 여부 |
| completed_at | timestamptz | NULLABLE | 완료 시각 |
| is_auto_suggested | boolean | DEFAULT true | 자동 추천 여부 (false면 수동 추가) |
| adjusted_difficulty | text | CHECK IN ('low','mid','high') | 조정된 난이도 |

#### `reflections` (저녁 회고)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 회고 ID |
| user_id | uuid | FK → users.id, NOT NULL | 사용자 |
| plan_id | uuid | FK → daily_plans.id, NOT NULL | 연결된 플랜 |
| date | date | NOT NULL | 회고 날짜 |
| note | text | NULLABLE | 한줄 회고 텍스트 |
| created_at | timestamptz | DEFAULT now() | |
| UNIQUE | (user_id, date) | | 하루 1회 |

#### `weekly_reports` (주간 리포트)
| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|---------|------|
| id | uuid | PK | 리포트 ID |
| user_id | uuid | FK → users.id, NOT NULL | 사용자 |
| week_start | date | NOT NULL | 주 시작일 (월요일) |
| week_end | date | NOT NULL | 주 종료일 (일요일) |
| avg_energy | numeric(3,1) | | 평균 에너지 |
| avg_sleep | numeric(3,1) | | 평균 수면 |
| avg_completion | numeric(5,2) | | 평균 달성률 |
| insight_text | text | | 생성된 인사이트 문장 |
| report_data | jsonb | | 상세 통계 데이터 |
| created_at | timestamptz | DEFAULT now() | |
| UNIQUE | (user_id, week_start) | | 주 1개 리포트 |

### 7-3. Row Level Security (RLS) 정책

```sql
-- 모든 테이블에 RLS 활성화
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE routines ENABLE ROW LEVEL SECURITY;
ALTER TABLE check_ins ENABLE ROW LEVEL SECURITY;
ALTER TABLE daily_plans ENABLE ROW LEVEL SECURITY;
ALTER TABLE plan_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE reflections ENABLE ROW LEVEL SECURITY;
ALTER TABLE weekly_reports ENABLE ROW LEVEL SECURITY;

-- 정책: 자신의 데이터만 CRUD 가능
CREATE POLICY "users_own_data" ON users
  FOR ALL USING (auth.uid() = id);

CREATE POLICY "routines_own_data" ON routines
  FOR ALL USING (auth.uid() = user_id);

-- (나머지 테이블도 동일 패턴)
```

### 7-4. 핵심 PostgreSQL 함수

```sql
-- 주간 리포트 생성 함수
CREATE OR REPLACE FUNCTION generate_weekly_report(
  p_user_id uuid,
  p_week_start date
) RETURNS void AS $$
DECLARE
  v_avg_energy numeric;
  v_avg_sleep numeric;
  v_avg_completion numeric;
  v_insight text;
BEGIN
  -- 주간 평균 계산
  SELECT AVG(energy), AVG(sleep_hours)
  INTO v_avg_energy, v_avg_sleep
  FROM check_ins
  WHERE user_id = p_user_id
    AND date BETWEEN p_week_start AND p_week_start + 6;

  SELECT AVG(completion_rate)
  INTO v_avg_completion
  FROM daily_plans
  WHERE user_id = p_user_id
    AND date BETWEEN p_week_start AND p_week_start + 6;

  -- 인사이트 생성 (에너지-달성률 상관관계)
  SELECT CASE
    WHEN corr > 0.5 THEN
      '에너지가 높은 날 달성률이 눈에 띄게 높아요. 컨디션 관리가 핵심입니다.'
    WHEN corr > 0 THEN
      '에너지와 달성률이 약한 양의 관계를 보여요.'
    ELSE
      '이번 주는 에너지와 관계없이 꾸준히 수행했어요!'
  END INTO v_insight
  FROM (
    SELECT corr(c.energy, d.completion_rate) as corr
    FROM check_ins c
    JOIN daily_plans d ON c.user_id = d.user_id AND c.date = d.date
    WHERE c.user_id = p_user_id
      AND c.date BETWEEN p_week_start AND p_week_start + 6
  ) sub;

  -- 리포트 저장
  INSERT INTO weekly_reports (user_id, week_start, week_end, avg_energy, avg_sleep, avg_completion, insight_text)
  VALUES (p_user_id, p_week_start, p_week_start + 6, v_avg_energy, v_avg_sleep, v_avg_completion, v_insight)
  ON CONFLICT (user_id, week_start) DO UPDATE
  SET avg_energy = v_avg_energy, avg_sleep = v_avg_sleep,
      avg_completion = v_avg_completion, insight_text = v_insight;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

---

## 8. API 설계

### 8-1. API 개요

Supabase를 사용하므로, 대부분의 CRUD는 **Supabase Client SDK의 자동 생성 REST API**를 직접 호출한다. 커스텀 로직이 필요한 경우에만 **Supabase Edge Functions** 또는 **PostgreSQL RPC**를 사용한다.

### 8-2. Supabase Client SDK 활용 (자동 REST API)

| 엔티티 | 작업 | 호출 방식 |
|--------|------|----------|
| routines | CRUD | `supabase.from('routines').select/insert/update/delete()` |
| check_ins | Create, Read | `supabase.from('check_ins').insert/select()` |
| daily_plans | Create, Read, Update | `supabase.from('daily_plans').insert/select/update()` |
| plan_items | CRUD | `supabase.from('plan_items').select/insert/update/delete()` |
| reflections | Create, Read | `supabase.from('reflections').insert/select()` |
| weekly_reports | Read | `supabase.from('weekly_reports').select()` |

### 8-3. 커스텀 RPC (PostgreSQL Functions)

#### `rpc/generate_weekly_report`
| 항목 | 명세 |
|------|------|
| 목적 | 특정 주의 주간 리포트 생성 |
| 파라미터 | `p_user_id: uuid`, `p_week_start: date` |
| 반환 | void (결과는 weekly_reports 테이블에 저장) |
| 호출 | `supabase.rpc('generate_weekly_report', { p_user_id, p_week_start })` |
| 트리거 | 매주 일요일 Supabase Cron (pg_cron) 또는 클라이언트 요청 시 |

#### `rpc/get_dashboard_stats`
| 항목 | 명세 |
|------|------|
| 목적 | 홈 대시보드용 요약 통계 |
| 파라미터 | `p_user_id: uuid` |
| 반환 | `{ streak_days, weekly_avg_completion, total_check_ins, most_completed_routine }` |
| 호출 | `supabase.rpc('get_dashboard_stats', { p_user_id })` |

### 8-4. Supabase Edge Functions

#### `POST /functions/v1/process-subscription`
| 항목 | 명세 |
|------|------|
| 목적 | RevenueCat 웹훅 수신 → 구독 상태 동기화 |
| 입력 | RevenueCat webhook payload |
| 처리 | users.is_premium, premium_expires_at 업데이트 |
| 인증 | RevenueCat webhook secret 검증 |

### 8-5. 인증 플로우

```
[사용자] → 카카오/애플 로그인 버튼
  ↓
[Supabase Auth] → OAuth Provider 인증
  ↓
[JWT 토큰 발급] → 클라이언트 저장
  ↓
[모든 API 요청] → Authorization: Bearer <JWT>
  ↓
[Supabase RLS] → auth.uid()로 자동 데이터 격리
```

---

## 9. 화면 구성 (Screen Map)

### 9-1. 네비게이션 구조

```
App
├── Auth Stack (미인증)
│   ├── Welcome Screen
│   ├── Login Screen (카카오/애플/이메일)
│   └── Onboarding Flow (3단계)
│       ├── Step 1: 관심 카테고리 선택
│       ├── Step 2: 루틴 템플릿 선택
│       └── Step 3: 알림 시간 설정
│
└── Main Tab Navigator (인증 완료)
    ├── Tab 1: 홈 (Today)
    │   ├── 체크인 카드 (미입력 시)
    │   ├── 오늘의 루틴 리스트 (체크인 완료 시)
    │   └── 달성률 프로그레스 바
    │
    ├── Tab 2: 루틴 관리
    │   ├── 루틴 풀 리스트
    │   ├── 루틴 추가/편집 모달
    │   └── 카테고리 관리
    │
    ├── Tab 3: 리포트
    │   ├── 주간 리포트 카드 리스트
    │   ├── 주간 상세 (차트 + 인사이트)
    │   └── 캘린더 뷰 (P1)
    │
    └── Tab 4: 설정
        ├── 프로필 편집
        ├── 알림 설정
        ├── 구독 관리
        ├── 데이터 내보내기
        └── 회원 탈퇴
```

### 9-2. 핵심 화면 와이어프레임 설명

#### 홈 화면 (체크인 전)
- 상단: "좋은 아침이에요, {닉네임}님" 인사말
- 중앙: 체크인 카드 (에너지 슬라이더 + 수면 피커 + 기분 탭)
- 하단: "체크인하고 오늘의 루틴 받기" CTA 버튼

#### 홈 화면 (체크인 후)
- 상단: 오늘의 컨디션 요약 뱃지 (예: "에너지 4 · 수면 7h · 기분 좋음")
- 중앙: 오늘의 루틴 리스트 (체크박스 + 루틴명 + 소요시간 + 난이도 뱃지)
- 하단: 달성률 프로그레스 바 + "루틴 교체하기" 버튼

#### 저녁 회고 (모달)
- 오늘 달성률 표시 (원형 차트)
- 한줄 회고 입력 필드
- "수고했어요" 격려 메시지

---

## 10. 적응형 루틴 엔진 상세 설계

### 10-1. 엔진 개요

적응형 루틴 엔진은 **클라이언트 로컬에서 실행**되는 규칙 기반(Rule-based) 시스템이다. 서버 왕복 없이 체크인 즉시 루틴을 제안한다.

### 10-2. 입력/출력

```
입력:
  - energy: 1-5 (에너지 레벨)
  - sleep_hours: number (수면 시간)
  - mood: 'good' | 'normal' | 'bad' (기분)
  - routinePool: Routine[] (사용자의 활성 루틴 풀)

출력:
  - suggestedRoutines: PlanItem[] (오늘의 추천 루틴, 최대 5개)
  - totalDuration: number (총 예상 소요 시간)
```

### 10-3. 규칙 매트릭스

| 조건 | 허용 난이도 | 최대 총 시간 | 특별 규칙 |
|------|-----------|------------|----------|
| 에너지 1 | low만 | 20분 | 마음챙김 1개 필수 |
| 에너지 2 | low만 | 30분 | — |
| 에너지 3 | low + mid | 60분 | — |
| 에너지 4 | low + mid + high | 90분 | — |
| 에너지 5 | low + mid + high | 120분 | — |
| 기분 'bad' | — | — | 마음챙김 카테고리 1개 추가 포함 |
| 수면 < 5h | — | — | 운동 카테고리 난이도 1단계 하향 |
| 수면 < 4h | — | 에너지 레벨 최대 2로 캡 | 강제 경량화 |

### 10-4. 선택 알고리즘

```
1. 필터링: 에너지 레벨에 따라 허용 난이도 이하 루틴만 필터
2. 수면 보정: 수면 부족 시 운동 난이도 하향
3. 기분 보정: 기분 'bad' 시 마음챙김 루틴 1개 필수 선택
4. 시간 제한 내 선택:
   a. 카테고리 다양성 우선 (같은 카테고리 최대 2개)
   b. 최근 7일 달성률 높은 루틴 우선 (성공 경험 강화)
   c. 시간 합계가 최대 총 시간 이내가 되도록 선택
5. 정렬: 난이도 낮은 순 (성취감 순서)
```

### 10-5. Post-MVP 고도화 방향

- **학습 기반 추천**: 과거 N일간 (에너지, 수면, 기분) → 달성률 패턴 학습
- **시간대 고려**: 퇴근 시간 입력 시 남은 시간에 맞게 재조정
- **LLM 인사이트**: 누적 데이터로 개인화 코칭 메시지 생성 (유료 전용)

---

## 11. 시장 분석 요약

> 상세: `research/market-data/001-시장분석.md`

### 11-1. 시장 규모

| 구분 | 규모 | 근거 |
|------|------|------|
| TAM | 약 320억 원/년 | 한국 건강/웰니스 앱 카테고리 (Sensor Tower) |
| SAM | 약 85억 원/년 | MZ세대 직장인 710만 × 유료 4% × 연 29,900원 |
| SOM (1년차) | 0.5~1.5억 원 | 5~10만 사용자, 유료 전환율 3-5% |
| SOM (2년차) | 5~10억 원 | 30~50만 사용자 |

### 11-2. 시장 성장 동인
- 레디코어 트렌드 (체계적 자기관리 시스템 수요, 2026)
- 건강지능(HQ) 개념 부상
- AI 기반 개인화 서비스 수용성 급증 (ChatGPT 한국 사용자 341% 증가)
- 1인가구 40% 돌파 → 자기관리 수요 증가
- 직장인 번아웃 사회 (69~93% 경험)

---

## 12. 경쟁 분석 요약

> 상세: `research/competitors/001-경쟁분석.md`

### 12-1. 경쟁 포지셔닝

```
         고정 루틴 ←──────────────────→ 적응형 루틴
              │                              │
  실행 도구 ─ 루티너리    마이루틴             │
              │                              │
              │    투두메이트                  │   [데일리셀프]
              │                              │   "컨디션 인식
              │         루빗                  │    적응형 루틴"
              │                              │
  동기부여 ─ 챌린저스                          │
              │                              │
```

### 12-2. 차별화 요약

| 차별점 | 데일리셀프 | 경쟁사 전체 |
|--------|-----------|-----------|
| 컨디션 기반 루틴 조절 | O (핵심) | X (0/6) |
| 아침 체크인 → 적응형 플랜 | O | X |
| 에너지-달성률 인사이트 | O | X |
| 실패하지 않는 구조 | O (난이도 자동 하향) | X (고정 or 실패 처리) |

---

## 13. 수익 모델

### 13-1. 프리미엄 구독 모델

| 구분 | 무료 (Free) | 프리미엄 (Premium) |
|------|------------|-------------------|
| 가격 | ₩0 | 월 ₩3,900 / 연 ₩29,900 |
| 루틴 등록 | 최대 5개 | 무제한 |
| 카테고리 | 기본 5개 | 커스텀 카테고리 추가 |
| 주간 리포트 | O (기본) | O (상세) |
| AI 개인화 인사이트 | X | O |
| 월간 트렌드 분석 | X | O |
| 셀프케어 콘텐츠 | X | O |
| 데이터 내보내기 | X | O |

### 13-2. 가격 책정 근거

- 마이루틴: 월 3,900원 / 연 28,000원 → 동일 가격대로 시장 검증 완료
- 루티너리: 월 3,500원 / 연 25,000원 → 유사 범위
- MZ세대 월 자기관리 지출 의향: 평균 17.9만원 → 월 3,900원은 부담 없는 수준

### 13-3. 수익 전망

| 지표 | 1년차 | 2년차 |
|------|------|------|
| 총 사용자 | 5~10만 | 30~50만 |
| 유료 전환율 | 3% | 5% |
| 유료 사용자 | 1,500~3,000 | 15,000~25,000 |
| 연간 매출 | 0.5~1억 원 | 4.5~7.5억 원 |
| LTV (유료 사용자) | ~20,000원 | ~25,000원 |

---

## 14. MVP 개발 로드맵

### Phase 1: 기반 구축 (1~4주)

| 주차 | 작업 |
|------|------|
| 1주 | 프로젝트 셋업 (Expo + TypeScript + Supabase), 디자인 시스템 정의, DB 스키마 생성 |
| 2주 | 인증 구현 (카카오, 애플 소셜 로그인), 온보딩 플로우 UI |
| 3주 | 루틴 CRUD (루틴 풀 관리, 카테고리, 템플릿 데이터) |
| 4주 | 루틴 풀 UI 완성, RLS 정책 적용, 기본 네비게이션 구조 |

### Phase 2: 핵심 기능 (5~8주)

| 주차 | 작업 |
|------|------|
| 5주 | 아침 체크인 UI (슬라이더, 피커, 탭), 체크인 데이터 저장 |
| 6주 | 적응형 루틴 엔진 구현 (규칙 기반 매칭 로직) |
| 7주 | 오늘의 루틴 리스트 UI, 루틴 체크/완료 기능, 달성률 계산 |
| 8주 | 저녁 회고 모달, 푸시 알림 (아침/저녁) |

### Phase 3: 인사이트 + 출시 (9~12주)

| 주차 | 작업 |
|------|------|
| 9주 | 주간 리포트 생성 로직 (PostgreSQL 함수), 리포트 UI |
| 10주 | RevenueCat 인앱결제 연동, 프리미엄 기능 분기 처리 |
| 11주 | QA, 버그 수정, 성능 최적화, 앱스토어 심사 준비 |
| 12주 | 앱스토어/플레이스토어 제출, 랜딩 페이지, 론칭 |

---

## 15. 성공 지표 (KPI)

### 15-1. 핵심 지표

| 지표 | 정의 | MVP 목표 (출시 3개월) |
|------|------|---------------------|
| DAU | 일일 활성 사용자 | 3,000명 |
| 체크인 완료율 | 당일 체크인 완료 / DAU | 70% 이상 |
| D7 리텐션 | 설치 7일 후 재방문율 | 40% 이상 |
| D30 리텐션 | 설치 30일 후 재방문율 | 20% 이상 |
| 주간 루틴 달성률 | 주간 평균 (완료 루틴 / 제안 루틴) | 60% 이상 |
| 유료 전환율 | 유료 구독 / 전체 사용자 | 3% 이상 |

### 15-2. 북극성 지표 (North Star Metric)

**"주간 체크인 완료율"** — 사용자가 매일 아침 체크인을 하는 행위가 앱의 핵심 가치 루프의 시작점. 체크인 없이는 적응형 루틴 제안이 불가하므로, 이 지표가 전체 가치 체인의 선행 지표.

### 15-3. 가치 루프

```
아침 체크인 → 적응형 루틴 제안 → 달성 가능한 목표 수행 → 달성감
     ↑                                                    │
     └──── 다음 날 체크인 동기 ←─── 주간 인사이트 ←────────┘
```

---

## 16. 리스크 분석

### 16-1. 리스크 매트릭스

| 리스크 | 확률 | 영향도 | 심각도 | 대응 방안 |
|--------|------|-------|--------|----------|
| 경쟁사(마이루틴 등)가 컨디션 적응 기능 추가 | 중 | 높음 | **높음** | 빠른 실행 + 데이터 축적 + 사용자 경험 우위 확보 |
| 유료 전환율 3% 미달 | 높음 | 높음 | **높음** | AI 인사이트 가치 증명, B2B 기업 복지 채널 탐색 |
| 앱 이탈률 48% 이상 | 중 | 높음 | **높음** | "실패하지 않는 구조" 자체가 이탈 방지 설계, 주간 리포트로 재방문 유도 |
| 체크인 피로감 (매일 입력 귀찮음) | 중 | 중 | **중** | 30초 이내 UX 유지, 미입력 시 자동 적용 옵션, 웨어러블 연동(Post-MVP) |
| 앱스토어 리뷰 심사 지연 | 낮음 | 중 | **낮음** | 가이드라인 사전 준수, 여유 일정 확보 |
| Supabase 서비스 장애 | 낮음 | 높음 | **중** | 로컬 퍼스트 아키텍처로 핵심 기능은 오프라인 동작 |

### 16-2. 의존성 리스크

| 외부 의존성 | 리스크 | 대응 |
|------------|--------|------|
| Supabase | 서비스 종료/가격 인상 | 표준 PostgreSQL이므로 마이그레이션 용이 |
| RevenueCat | 정책 변경/수수료 인상 | react-native-iap로 대체 가능 |
| Expo Push | 서비스 제한 | Firebase Cloud Messaging으로 대체 가능 |
| 카카오 로그인 API | 정책 변경 | 애플/이메일 로그인이 대안 |

---

## 17. 법적/규제 검토

| 항목 | 상태 | 비고 |
|------|------|------|
| 개인정보보호법 | 준수 필요 | 개인정보처리방침 작성, 수집 동의 절차 |
| 앱스토어 가이드라인 | 준수 필요 | 인앱결제 정책 준수 (iOS 30% 수수료) |
| 건강 데이터 규제 | 해당 없음 | 의료 데이터가 아닌 주관적 컨디션 입력 (에너지/기분) |
| 구독 해지 규정 | 준수 필요 | 전자상거래법 기반 구독 해지 용이성 보장 |
| 통신비밀보호법 | 해당 없음 | 통신 데이터 미수집 |

---

## 18. Go-to-Market 전략

### 18-1. 론칭 전략

| 단계 | 활동 | 채널 |
|------|------|------|
| **프리론칭 (출시 2주 전)** | 랜딩 페이지 + 사전 등록 | 인스타그램, 블라인드 |
| **베타 (출시 1주 전)** | 직장인 커뮤니티 베타 테스트 (100명) | 블라인드, 잡플래닛 |
| **론칭** | 앱스토어/플레이스토어 출시 | ASO 최적화 |
| **초기 성장 (출시 후 1~3개월)** | 콘텐츠 마케팅 + 커뮤니티 | 인스타 #갓생, 블로그 |

### 18-2. 핵심 마케팅 메시지

**"작심삼일은 당신의 의지력 문제가 아닙니다. 앱이 당신의 컨디션을 몰랐을 뿐입니다."**

### 18-3. 사용자 획득 채널

| 채널 | 예상 효과 | 비용 |
|------|----------|------|
| ASO (앱스토어 최적화) | 중 | 무료 |
| 인스타그램 #갓생 #루틴 타겟 광고 | 높음 | 월 50~100만 원 |
| 블라인드/잡플래닛 직장인 커뮤니티 | 높음 | 무료~저비용 |
| "오늘의 컨디션" SNS 공유 바이럴 | 중 | 무료 |
| 블로그/유튜브 콘텐츠 마케팅 | 중 | 시간 투자 |

---

## 부록 A: 용어 정의

| 용어 | 정의 |
|------|------|
| 컨디션 체크인 | 매일 아침 에너지, 수면, 기분을 입력하는 행위 |
| 적응형 루틴 | 컨디션에 따라 난이도와 구성이 자동 조절되는 루틴 제안 |
| 루틴 풀 | 사용자가 등록한 모든 루틴의 집합 |
| 플랜 | 특정 날짜에 체크인 기반으로 생성된 루틴 조합 |
| 달성률 | 완료한 루틴 수 / 제안된 루틴 수 × 100% |
| 인사이트 | 누적 데이터 분석을 통해 도출된 개인화 패턴 정보 |
| 레디코어 | 2026 트렌드로, 체계적 자기관리를 추구하는 소비 트렌드 |

## 부록 B: 참조 문서

| 문서 | 위치 |
|------|------|
| 아이디어 원문 | `ideas/001-데일리셀프.md` |
| 경쟁 분석 | `research/competitors/001-경쟁분석.md` |
| 시장 분석 | `research/market-data/001-시장분석.md` |
| 평가 기준 | `evaluation/criteria.md` |

---

> **다음 단계**: 4단계 PRD 정합성 판별 → `/stage-4 001-데일리셀프`
